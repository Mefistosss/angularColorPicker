!function(){"use strict";{var n=angular.module("angularColorPicker",[]),e=angular.element;angular.forEach}n.value("acpOptions",{imgPath:"../img/bgGradient.png",startPosition:{x:"center",y:"center"},saveLastPosition:!0}),n.service("acpLib",function(){return{pareseRgb:function(n){var e=[];return"none"!==n?(n=n.split("(")[1],n=n.split(")")[0],n=n.split(","),angular.forEach(n,function(n){e.push(parseInt(n))}),e):n},pareseHex:function(n){var e,t=[],o=2,c=2,i=0;if("none"!==n){if(n=n.replace("#",""),e=n.length,6===e||3===e)for(3===e&&(o=1,c=1);e!==i;)t.push(parseInt(n.substr(i,o),16)),i+=c;else t=[255,255,255];return t}return n},cleanString:function(n){return n.replace(/\s+/g,"")},obj:{positX:function(n){var e,t;return e=0,t=n.getBoundingClientRect(),n=document.body,e=document.documentElement,e=t.left+(e.scrollLeft||n&&n.scrollLeft||0)-(e.clientLeft||n.sclientLeft||0),Math.round(e)},positY:function(n){var e,t;return e=0,t=n.getBoundingClientRect(),n=document.body,e=document.documentElement,e=t.top+(e.scrollTop||n&&n.scrollTop||0)-(e.clientTop||n.sclientTop||0),Math.round(e)}},mouse:{pageX:function(n){var e,t,o;return o=n||event,null==o.pageX&&null!=o.clientX?(e=document.body,t=document.documentElement,n=t.scrollLeft||e&&e.scrollLeft||0,n=o.clientX+n-(t.clientLeft||e.clientLeft||0)):o.pageX},pageY:function(n){var e,t,o;return o=n||event,null==o.pageX&&null!=o.clientX?(e=document.body,t=document.documentElement,n=t.scrollTop||e&&e.scrollTop||0,n=o.clientY+n-(t.clientTop||e.clientTop||0)):o.pageY}},convertRgbToHex:function(n){return("0"+parseInt(n[0],10).toString(16)).slice(-2)+("0"+parseInt(n[1],10).toString(16)).slice(-2)+("0"+parseInt(n[2],10).toString(16)).slice(-2)},hsv_rgb:function(n,e,t){var o,c,i,r,a,s,u,d;switch(e/=100,t/=100,a=Math.floor(n/60),o=n/60-a,c=t*(1-e),i=t*(1-e*o),r=t*(1-(1-o)*e),a){case 0:s=t,u=r,d=c;break;case 1:s=i,u=t,d=c;break;case 2:s=c,u=t,d=r;break;case 3:s=c,u=i,d=t;break;case 4:s=r,u=c,d=t;break;case 5:s=t,u=c,d=i}return[parseInt(255*s),parseInt(255*u),parseInt(255*d)]},rgb_hsv:function(n){var e,t,o,c,i,r,a,s=[];return n&&n.length>0&&(o=Math.max(n[0],n[1],n[2]),c=Math.min(n[0],n[1],n[2]),t=0===o?0:(o-c)/o,0===t?e=359:(i=(o-n[0])/(o-c),r=(o-n[1])/(o-c),a=(o-n[2])/(o-c),n[0]===o&&(e=a-r),n[1]===o&&(e=2+i-a),n[2]===o&&(e=4+r-i),e=60*e,0>e&&(e+=360)),s.push(e),s.push(t),s.push(o)),s}}}),n.factory("acpModel",function(){var n=[],e={checkInstance:function(e){return e&&n[e]},getInstance:function(e){return n[e]},removeInstance:function(t){e.checkInstance(t)&&delete n[t]},newInstance:function(t){return e.removeInstance(t),n[t]={blockBGColor:"red",rgb:"rgb(255,255,255)",hex:"#ffffff",hue:0,none:!1,picker:{V:100,S:100}}}};return e}),n.directive("angularColorPicker",["$compile","$document","acpModel","acpLib",function(n,t,o,c){return{restrict:"A",scope:{},require:"?ngModel",link:function(i,r,a,s){var u,d,l=a.id||"angular-color-picker-"+Date.now(),p=!1,b=e("<div>"),m=/rgb/,f=function(r){var d,f;u=o.newInstance(l),e(t[0].body).append(b[0]),a.ngModel,s.$valid,(d=c.cleanString(s.$viewValue))&&(f=m.test(d)?c.pareseRgb(d):c.pareseHex(d),u.rgb=d,"none"===f?(u.rgb="",u.hex="",u.hsv="none",u.hue=0,u.picker.V=100,u.picker.S=100,u.blockBGColor="red",u.none=!0):(u.hex="#"+c.convertRgbToHex(f),u.hsv=c.rgb_hsv(f),u.none=!1),p=!0),t.bind("mousedown",h),n(b)(i)},g=function(){o.removeInstance(l),p=!1,t.unbind("mousedown",h),b.remove()},h=function(n){for(var e=n.target;e&&e!==b[0];)e=e.parentNode;e!==b[0]&&g()};b.addClass("angular-color-picker"),b.attr("acp-window",""),b.attr("name",l),d=c.cleanString(a.angularColorPicker),"rgb"!==d&&"hex"!==d&&(d="rgb"),i.$on("acpEvent",function(n){n.stopPropagation(),p&&s.$setViewValue(u[d])}),i.$on("closeAcp",function(n){n.stopPropagation(),g()}),r.bind("click",f),r.bind("$destroy",function(n){r.unbind("click",f),t.unbind("mousedown",h)})}}}]),n.directive("acpWindow",["acpLib","acpModel",function(n,e){return{restrict:"A",scope:!0,template:'<div class="acp-control-panel" acp-control-panel></div><div class="acp-main-panel" acp-main-panel></div>',link:function(t,o,c){t.instance=e.getInstance(c.name),t.checkboxChange=function(){var e=t.instance;e.picker.V=100,e.picker.S=100,e.hue=0,e.none?(e.rgb="",e.hex="",e.hsv="none",e.blockBGColor="red"):(e.rgb="rgb(0,0,0)",e.hex="#000",e.hsv=n.rgb_hsv(n.pareseRgb(e.rgb)),e.blockBGColor="rgb("+n.hsv_rgb(0,100,100)+")"),t.$emit("acpEvent")}}}}]),n.directive("acpControlPanel",["$compile","$window","acpLib","acpOptions",function(n,t,o,c){return{restrict:"A",template:'<button class="acp-close-button">X</button>',link:function(n,i,r){var a,s,u=i[0].childNodes[0],d=i.parent()[0].offsetWidth,l=i.parent()[0].offsetHeight,p=t.document.documentElement.clientWidth,b=t.document.documentElement.clientHeight,m=0,f=0,g=c.startPosition.x,h=c.startPosition.y,v=function(n){var e,t;e=o.mouse.pageY(n)-f,t=o.mouse.pageX(n)-m,0>e&&(e=0),0>t&&(t=0),t+d>p&&(t=p-d),e+l>b&&(e=b-l),c.saveLastPosition&&(c.startPosition.x=t+"px",c.startPosition.y=e+"px"),i.parent().css({top:e+"px",left:t+"px"})},k=function(n){1===n.which&&(i.css("cursor",""),e(t.document).unbind("mousemove",v),e(t.document).unbind("mouseup",k))},w=function(n){1===n.which&&n.target!==u&&(n.preventDefault(),i.css("cursor","move"),m=o.mouse.pageX(n)-o.obj.positX(i[0]),f=o.mouse.pageY(n)-o.obj.positY(i[0]),e(t.document).bind("mouseup",k),e(t.document).bind("mousemove",v))},x=function(e){n.$emit("closeAcp")};"center"!==g&&(a=parseFloat(g),(isNaN(a)||void 0===a)&&(g="center")),"center"!==h&&(s=parseFloat(h),(isNaN(s)||void 0===s)&&(h="center")),i.parent().css({top:"center"===h?b/2-l/2+"px":h,left:"center"===g?p/2-d/2+"px":g}),i.bind("mousedown",w),e(u).bind("click",x),i.bind("$destroy",function(n){e(u).unbind("click",x),e(t.document).unbind("mousemove",v),e(t.document).unbind("mouseup",k),i.unbind("mousedown",w)})}}}]),n.directive("acpMainPanel",["$compile",function(n){return{restrict:"A",template:'<div class="acp-line-piker" acp-line></div><div class="acp-block-picker" acp-block="blockBGColor"></div><div class="acp-out-color" acp-out></div><div class="acp-text"><span>{{instance.rgb}}</span></br><span>{{instance.hex}}</span></br>none: <input ng-model="instance.none" type="checkbox" ng-change="checkboxChange()"></div>'}}]),n.directive("acpLine",["$compile","$window","acpLib",function(n,t,o){var c=function(n,e,t){var o,c,i,n;n=n.getContext("2d"),o=n.createLinearGradient(t/2,e,t/2,0),c=[[255,0,0],[255,255,0],[0,255,0],[0,255,255],[0,0,255],[255,0,255],[255,0,0]];for(var r=0;6>=r;r++)i="rgb("+c[r][0]+","+c[r][1]+","+c[r][2]+")",o.addColorStop(1*r/6,i);n.fillStyle=o,n.fillRect(0,0,t,e)};return{restrict:"A",template:'<div class="acp-arrows"><div id="acp-left-arrow"></div><div id="acp-right-arrow"></div></div><canvas width="20" height="180" class="acp-cLine"></canvas>',link:function(n,i,r){var a,s,u=0,d=i[0].childNodes[0],l={width:20,height:180,node:i[0].childNodes[1]},p=function(e){var t,c;t=o.mouse.pageY(e)-a,t=0>t?0:t,t=t>l.height?l.height:t,d.style.top=t-2+"px",u=Math.round(t/(l.height/360)),u=Math.abs(u-360),u=360==u?0:u,n.instance.hue=u,c=o.hsv_rgb(u,n.instance.picker.S,n.instance.picker.V),n.$apply(function(){n.instance.blockBGColor="rgb("+o.hsv_rgb(u,100,100)+")",n.instance.rgb="rgb("+c+")",n.instance.hex="#"+o.convertRgbToHex(c),n.$emit("acpEvent")})},b=function(e){var t=180-180/(360/e);d.style.top=t-2+"px",n.instance.hue=e,n.instance.blockBGColor="rgb("+o.hsv_rgb(e,100,100)+")"},m=function(n){p(n)},f=function(n){n.preventDefault(),e(t.document).unbind("mousemove",m),e(t.document).unbind("mouseup",f)},g=function(c){1===c.which&&(c.preventDefault(),n.instance.none=!1,a=o.obj.positY(l.node),e(t.document).bind("mouseup",f),e(t.document).bind("mousemove",m))},h=function(n){1===n.which&&(n.preventDefault(),a=o.obj.positY(l.node),e(t.document).bind("mouseup",f),e(t.document).bind("mousemove",m))},v=function(e){n.instance.none=!1,p(e)};l.node.width=l.width,l.node.height=l.height,c(l.node,l.height,l.width),e(d).bind("mousedown",g),e(d.node).bind("click",p),e(l.node).bind("click",v),e(l.node).bind("mousedown",h),s=n.$watch("instance.hsv",function(n){n&&n.length>0&&("none"===n&&(n=[359,0,0]),b(n[0]))}),i.bind("$destroy",function(n){s(),e(t.document).unbind("mouseup",f),e(t.document).unbind("mousemove",m),e(d.node).unbind("click",p),e(d).unbind("mousedown",g),e(l.node).unbind("click",v),e(l.node).unbind("mousedown",h)})}}}]),n.directive("acpBlock",["$compile","$window","acpLib","acpOptions",function(n,t,o,c){return{restrict:"A",template:'<img src="'+c.imgPath+'"><div class="acp-circle"></div>',link:function(n,c,i){var r,a,s,u,d,l,p,b,m,f,g=c[0],h=g.childNodes[1],v=function(t){var i,r,a,g,v;c.bind("dragstart",function(){return!1}),c.bind("onselectstart",function(){return!1}),a=o.mouse.pageX(t)-s-p/2,a=0>a?0:a,a=a>d?d:a,e(h).css("left",a+"px"),g=Math.ceil(a/f),r=o.mouse.pageY(t)-u-b/2,r=r>l?l:r,r=0>r?0:r,e(h).css("top",r+"px"),v=Math.ceil(Math.abs(r/m-100)),n.instance.picker.S=g,n.instance.picker.V=v,i=o.hsv_rgb(n.instance.hue,g,v),n.$apply(function(){n.instance.rgb="rgb("+i+")",n.instance.hex="#"+o.convertRgbToHex(i),n.$emit("acpEvent")})},k=function(n){var t=l-l/(255/n[2]),o=d/(1/n[1]);e(h).css({top:t+"px",left:o+"px"})},w=function(n){s=o.obj.positX(g),u=o.obj.positY(g),v(n)},x=function(n){n.preventDefault(),e(t.document).unbind("mousemove",w),e(t.document).unbind("mouseup",x)},$=function(o){1===o.which&&(o.preventDefault(),n.instance.none=!1,w(o),e(t.document).bind("mouseup",x),e(t.document).bind("mousemove",w))},y=function(n){v(n)};r=n.$watch("instance.blockBGColor",function(n){c.css("background-color",n)}),p=h.offsetWidth,b=h.offsetHeight,d=g.offsetWidth-p,l=g.offsetHeight-b,m=l/100,f=d/100,c.bind("click",y),c.bind("mousedown",$),a=n.$watch("instance.hsv",function(n){n&&n.length>0&&("none"===n&&(n=[359,0,0]),k(n))}),c.bind("$destroy",function(n){r(),a(),c.unbind("mousedown",$),c.unbind("click",y)})}}}]),n.directive("acpOut",["$compile",function(n){return{restrict:"A",scope:!1,link:function(n,e,t){var o=n.$watch("instance.rgb",function(n){e.css("background-color",n)});e.bind("$destroy",function(){o()})}}}])}();