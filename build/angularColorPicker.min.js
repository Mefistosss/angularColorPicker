!function(){"use strict";{var n=angular.module("angularColorPicker",[]),e=angular.element;angular.forEach}n.value("imgPath","../img/bgGradient.png"),n.service("acpLib",function(){return{pareseRgb:function(n){var e=[];return"none"!==n?(n=n.split("(")[1],n=n.split(")")[0],n=n.split(","),angular.forEach(n,function(n){e.push(parseInt(n))}),e):n},cleanString:function(n){return n.replace(/\s+/g,"")},obj:{positX:function(n){var e,t;return e=0,t=n.getBoundingClientRect(),n=document.body,e=document.documentElement,e=t.left+(e.scrollLeft||n&&n.scrollLeft||0)-(e.clientLeft||n.sclientLeft||0),Math.round(e)},positY:function(n){var e,t;return e=0,t=n.getBoundingClientRect(),n=document.body,e=document.documentElement,e=t.top+(e.scrollTop||n&&n.scrollTop||0)-(e.clientTop||n.sclientTop||0),Math.round(e)}},mouse:{pageX:function(n){var e,t,o;return o=n||event,null==o.pageX&&null!=o.clientX?(e=document.body,t=document.documentElement,n=t.scrollLeft||e&&e.scrollLeft||0,n=o.clientX+n-(t.clientLeft||e.clientLeft||0)):o.pageX},pageY:function(n){var e,t,o;return o=n||event,null==o.pageX&&null!=o.clientX?(e=document.body,t=document.documentElement,n=t.scrollTop||e&&e.scrollTop||0,n=o.clientY+n-(t.clientTop||e.clientTop||0)):o.pageY}},hsv_rgb:function(n,e,t){var o,c,i,r,a,u,s,l;switch(e/=100,t/=100,a=Math.floor(n/60),o=n/60-a,c=t*(1-e),i=t*(1-e*o),r=t*(1-(1-o)*e),a){case 0:u=t,s=r,l=c;break;case 1:u=i,s=t,l=c;break;case 2:u=c,s=t,l=r;break;case 3:u=c,s=i,l=t;break;case 4:u=r,s=c,l=t;break;case 5:u=t,s=c,l=i}return[parseInt(255*u),parseInt(255*s),parseInt(255*l)]},rgb_hsv:function(n){var e,t,o,c,i,r,a,u=[];return n&&n.length>0&&(o=Math.max(n[0],n[1],n[2]),c=Math.min(n[0],n[1],n[2]),t=0===o?0:(o-c)/o,0===t?e=359:(i=(o-n[0])/(o-c),r=(o-n[1])/(o-c),a=(o-n[2])/(o-c),n[0]===o&&(e=a-r),n[1]===o&&(e=2+i-a),n[2]===o&&(e=4+r-i),e=60*e,0>e&&(e+=360)),u.push(e),u.push(t),u.push(o)),u}}}),n.factory("acpModel",function(){var n=[],e={checkInstance:function(e){return e&&n[e]},getInstance:function(e){return n[e]},removeInstance:function(t){e.checkInstance(t)&&delete n[t]},newInstance:function(t){return e.removeInstance(t),n[t]={blockBGColor:"red",rgb:"rgb(255,255,255)",hex:"#ffffff",hue:0,none:!1,picker:{V:100,S:100}}}};return e}),n.directive("angularColorPicker",["$compile","$document","acpModel","acpLib",function(n,t,o,c){return{restrict:"A",scope:{},require:"?ngModel",link:function(i,r,a,u){var s,l,d=a.id||"angular-color-picker-"+Date.now(),p=!1,g=e("<div>"),h=function(r){var l;if(s=o.newInstance(d),e(t[0].body).append(g[0]),a.ngModel,u.$valid,l=c.cleanString(u.$viewValue)){var h=c.pareseRgb(l);s.rgb=l,"none"===h?(s.rgb="",s.hex="",s.hsv="none",s.hue=0,s.picker.V=100,s.picker.S=100,s.blockBGColor="red",s.none=!0):(s.hex="#"+(h[0].toString(16)+""+h[1].toString(16)+h[2].toString(16)),s.hsv=c.rgb_hsv(h),s.none=!1),p=!0}n(g)(i)},f=function(n){for(var e=n.target;e&&e!==g[0];)e=e.parentNode;e!==g[0]&&(o.removeInstance(d),p=!1,g.remove())};g.addClass("color-picker"),g.attr("acp-window",""),g.attr("name",d),l=c.cleanString(a.angularColorPicker),"rgb"!==l&&"hex"!==l&&(l="rgb"),i.$on("ecpEvent",function(n){n.stopPropagation(),p&&u.$setViewValue(s[l])}),r.bind("click",h),t.bind("mousedown",f)}}}]),n.directive("acpWindow",["acpLib","acpModel",function(n,e){return{restrict:"A",scope:!0,template:'<div class="control-panel" acp-control-panel></div><div class="main-panel" acp-main-panel></div>',link:function(t,o,c){t.instance=e.getInstance(c.name),t.checkboxChange=function(){var e=t.instance;e.picker.V=100,e.picker.S=100,e.hue=0,e.none?(e.rgb="",e.hex="",e.hsv="none",e.blockBGColor="red"):(e.rgb="rgb(0,0,0)",e.hex="#000",e.hsv=n.rgb_hsv(n.pareseRgb(e.rgb)),e.blockBGColor="rgb("+n.hsv_rgb(0,100,100)+")"),t.$emit("ecpEvent")}}}}]),n.directive("acpControlPanel",["$compile","$window","acpLib",function(n,t,o){return{restrict:"A",template:'<button class="close-button">X</button>',link:function(n,c,i){var r=(c[0].childNodes[0],c.parent()[0].offsetWidth),a=c.parent()[0].offsetHeight,u=t.document.documentElement.clientWidth,s=t.document.documentElement.clientHeight,l=0,d=0,p=function(n){var e,t;e=o.mouse.pageY(n)-d,t=o.mouse.pageX(n)-l,0>e&&(e=0),0>t&&(t=0),t+r>u&&(t=u-r),e+a>s&&(e=s-a),c.parent().css({top:e+"px",left:t+"px"})},g=function(n){c.css("cursor",""),e(t.document).unbind("mousemove",p),e(t.document).unbind("mouseup",g)};c.bind("mousedown",function(n){1===n.which&&(n.preventDefault(),c.css("cursor","move"),l=o.mouse.pageX(n)-o.obj.positX(c[0]),d=o.mouse.pageY(n)-o.obj.positY(c[0]),e(t.document).bind("mouseup",g),e(t.document).bind("mousemove",p))})}}}]),n.directive("acpMainPanel",["$compile",function(n){return{restrict:"A",template:'<div class="line-piker" acp-line></div><div class="block-picker" acp-block="blockBGColor"></div><div class="out-color" acp-out></div><div class="text"><span>{{instance.rgb}}</span></br><span>{{instance.hex}}</span></br>none: <input ng-model="instance.none" type="checkbox" ng-change="checkboxChange()"></div>'}}]),n.directive("acpLine",["$compile","$window","acpLib",function(n,t,o){var c=function(n,e,t){var o,c,i,n;n=n.getContext("2d"),o=n.createLinearGradient(t/2,e,t/2,0),c=[[255,0,0],[255,255,0],[0,255,0],[0,255,255],[0,0,255],[255,0,255],[255,0,0]];for(var r=0;6>=r;r++)i="rgb("+c[r][0]+","+c[r][1]+","+c[r][2]+")",o.addColorStop(1*r/6,i);n.fillStyle=o,n.fillRect(0,0,t,e)};return{restrict:"A",template:'<div class="arrows"><div id="left-arrow"></div><div id="right-arrow"></div></div><canvas width="20" height="180" class="cLine"></canvas>',link:function(n,i,r){var a,u=0,s=i[0].childNodes[0],l={width:20,height:180,node:i[0].childNodes[1]},d=function(e){var t,c;t=o.mouse.pageY(e)-a,t=0>t?0:t,t=t>l.height?l.height:t,s.style.top=t-2+"px",u=Math.round(t/(l.height/360)),u=Math.abs(u-360),u=360==u?0:u,n.instance.hue=u,c=o.hsv_rgb(u,n.instance.picker.S,n.instance.picker.V),n.$apply(function(){n.instance.blockBGColor="rgb("+o.hsv_rgb(u,100,100)+")",n.instance.rgb="rgb("+c+")",n.instance.hex="#"+(c[0].toString(16)+""+c[1].toString(16)+c[2].toString(16)),n.$emit("ecpEvent")})},p=function(e){var t=180-180/(360/e);s.style.top=t-2+"px",n.instance.hue=e,n.instance.blockBGColor="rgb("+o.hsv_rgb(e,100,100)+")"},g=function(n){d(n)},h=function(n){n.preventDefault(),e(t.document).unbind("mousemove",g),e(t.document).unbind("mouseup",h)};l.node.width=l.width,l.node.height=l.height,c(l.node,l.height,l.width),e(s).bind("mousedown",function(c){1===c.which&&(c.preventDefault(),n.instance.none=!1,a=o.obj.positY(l.node),e(t.document).bind("mousemove",g))}),e(s.node).bind("click",d),e(l.node).bind("click",function(e){n.instance.none=!1,d(e)}),e(l.node).bind("mousedown",function(n){1===n.which&&(n.preventDefault(),a=o.obj.positY(l.node),e(t.document).bind("mouseup",h),e(t.document).bind("mousemove",g))}),n.$watch("instance.hsv",function(n){n&&n.length>0&&("none"===n&&(n=[359,0,0]),p(n[0]))})}}}]),n.directive("acpBlock",["$compile","$window","acpLib","imgPath",function(n,t,o,c){return{restrict:"A",template:'<img src="'+c+'"><div class="circle"></div>',link:function(n,c,i){var r,a,u,s,l,d,p,g,h=c[0],f=h.childNodes[1],b=function(t){var i,h,b,m,v;c.bind("dragstart",function(){return!1}),c.bind("onselectstart",function(){return!1}),b=o.mouse.pageX(t)-r-l/2,b=0>b?0:b,b=b>u?u:b,e(f).css("left",b+"px"),m=Math.ceil(b/g),h=o.mouse.pageY(t)-a-d/2,h=h>s?s:h,h=0>h?0:h,e(f).css("top",h+"px"),v=Math.ceil(Math.abs(h/p-100)),n.instance.picker.S=m,n.instance.picker.V=v,i=o.hsv_rgb(n.instance.hue,m,v),n.$apply(function(){n.instance.rgb="rgb("+i+")",n.instance.hex="#"+(i[0].toString(16)+""+i[1].toString(16)+i[2].toString(16)),n.$emit("ecpEvent")})},m=function(n){var t=s-s/(255/n[2]),o=u/(1/n[1]);e(f).css({top:t+"px",left:o+"px"})},v=function(n){r=o.obj.positX(h),a=o.obj.positY(h),b(n)},k=function(n){n.preventDefault(),e(t.document).unbind("mousemove",v),e(t.document).unbind("mouseup",k)};n.$watch("instance.blockBGColor",function(n){c.css("background-color",n)}),l=f.offsetWidth,d=f.offsetHeight,u=h.offsetWidth-l,s=h.offsetHeight-d,p=s/100,g=u/100,c.bind("click",function(n){b(n)}),c.bind("mousedown",function(o){1===o.which&&(o.preventDefault(),n.instance.none=!1,v(o),e(t.document).bind("mouseup",k),e(t.document).bind("mousemove",v))}),n.$watch("instance.hsv",function(n){n&&n.length>0&&("none"===n&&(n=[359,0,0]),m(n))})}}}]),n.directive("acpOut",["$compile",function(n){return{restrict:"A",scope:!1,link:function(n,e,t){n.$watch("instance.rgb",function(n){e.css("background-color",n)})}}}])}();