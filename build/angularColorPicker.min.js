!function(){"use strict";{var e=angular.module("angularColorPicker",[]),n=angular.element;angular.forEach}e.value("acpOptions",{imgPath:"../img/bgGradient.png",startPosition:{x:"center",y:"center"}}),e.service("acpLib",function(){return{pareseRgb:function(e){var n=[];return"none"!==e?(e=e.split("(")[1],e=e.split(")")[0],e=e.split(","),angular.forEach(e,function(e){n.push(parseInt(e))}),n):e},pareseHex:function(e){var n,t=[],o=2,c=2,i=0;if("none"!==e){if(e=e.replace("#",""),n=e.length,6===n||3===n)for(3===n&&(o=1,c=1);n!==i;)t.push(parseInt(e.substr(i,o),16)),i+=c;else t=[255,255,255];return t}return e},cleanString:function(e){return e.replace(/\s+/g,"")},obj:{positX:function(e){var n,t;return n=0,t=e.getBoundingClientRect(),e=document.body,n=document.documentElement,n=t.left+(n.scrollLeft||e&&e.scrollLeft||0)-(n.clientLeft||e.sclientLeft||0),Math.round(n)},positY:function(e){var n,t;return n=0,t=e.getBoundingClientRect(),e=document.body,n=document.documentElement,n=t.top+(n.scrollTop||e&&e.scrollTop||0)-(n.clientTop||e.sclientTop||0),Math.round(n)}},mouse:{pageX:function(e){var n,t,o;return o=e||event,null==o.pageX&&null!=o.clientX?(n=document.body,t=document.documentElement,e=t.scrollLeft||n&&n.scrollLeft||0,e=o.clientX+e-(t.clientLeft||n.clientLeft||0)):o.pageX},pageY:function(e){var n,t,o;return o=e||event,null==o.pageX&&null!=o.clientX?(n=document.body,t=document.documentElement,e=t.scrollTop||n&&n.scrollTop||0,e=o.clientY+e-(t.clientTop||n.clientTop||0)):o.pageY}},convertRgbToHex:function(e){return("0"+parseInt(e[0],10).toString(16)).slice(-2)+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)},hsv_rgb:function(e,n,t){var o,c,i,r,a,s,u,l;switch(n/=100,t/=100,a=Math.floor(e/60),o=e/60-a,c=t*(1-n),i=t*(1-n*o),r=t*(1-(1-o)*n),a){case 0:s=t,u=r,l=c;break;case 1:s=i,u=t,l=c;break;case 2:s=c,u=t,l=r;break;case 3:s=c,u=i,l=t;break;case 4:s=r,u=c,l=t;break;case 5:s=t,u=c,l=i}return[parseInt(255*s),parseInt(255*u),parseInt(255*l)]},rgb_hsv:function(e){var n,t,o,c,i,r,a,s=[];return e&&e.length>0&&(o=Math.max(e[0],e[1],e[2]),c=Math.min(e[0],e[1],e[2]),t=0===o?0:(o-c)/o,0===t?n=359:(i=(o-e[0])/(o-c),r=(o-e[1])/(o-c),a=(o-e[2])/(o-c),e[0]===o&&(n=a-r),e[1]===o&&(n=2+i-a),e[2]===o&&(n=4+r-i),n=60*n,0>n&&(n+=360)),s.push(n),s.push(t),s.push(o)),s}}}),e.factory("acpModel",function(){var e=[],n={checkInstance:function(n){return n&&e[n]},getInstance:function(n){return e[n]},removeInstance:function(t){n.checkInstance(t)&&delete e[t]},newInstance:function(t){return n.removeInstance(t),e[t]={blockBGColor:"red",rgb:"rgb(255,255,255)",hex:"#ffffff",hue:0,none:!1,picker:{V:100,S:100}}}};return n}),e.directive("angularColorPicker",["$compile","$document","acpModel","acpLib",function(e,t,o,c){return{restrict:"A",scope:{},require:"?ngModel",link:function(i,r,a,s){var u,l,p=a.id||"angular-color-picker-"+Date.now(),d=!1,f=n("<div>"),b=/rgb/,h=function(r){var l,h;u=o.newInstance(p),n(t[0].body).append(f[0]),a.ngModel,s.$valid,(l=c.cleanString(s.$viewValue))&&(h=b.test(l)?c.pareseRgb(l):c.pareseHex(l),u.rgb=l,"none"===h?(u.rgb="",u.hex="",u.hsv="none",u.hue=0,u.picker.V=100,u.picker.S=100,u.blockBGColor="red",u.none=!0):(u.hex="#"+c.convertRgbToHex(h),u.hsv=c.rgb_hsv(h),u.none=!1),d=!0),e(f)(i)},g=function(){o.removeInstance(p),d=!1,f.remove()},m=function(e){for(var n=e.target;n&&n!==f[0];)n=n.parentNode;n!==f[0]&&g()};f.addClass("color-picker"),f.attr("acp-window",""),f.attr("name",p),l=c.cleanString(a.angularColorPicker),"rgb"!==l&&"hex"!==l&&(l="rgb"),i.$on("acpEvent",function(e){e.stopPropagation(),d&&s.$setViewValue(u[l])}),i.$on("closeAcp",function(e){e.stopPropagation(),g()}),r.bind("click",h),t.bind("mousedown",m)}}}]),e.directive("acpWindow",["acpLib","acpModel",function(e,n){return{restrict:"A",scope:!0,template:'<div class="control-panel" acp-control-panel></div><div class="main-panel" acp-main-panel></div>',link:function(t,o,c){t.instance=n.getInstance(c.name),t.checkboxChange=function(){var n=t.instance;n.picker.V=100,n.picker.S=100,n.hue=0,n.none?(n.rgb="",n.hex="",n.hsv="none",n.blockBGColor="red"):(n.rgb="rgb(0,0,0)",n.hex="#000",n.hsv=e.rgb_hsv(e.pareseRgb(n.rgb)),n.blockBGColor="rgb("+e.hsv_rgb(0,100,100)+")"),t.$emit("acpEvent")}}}}]),e.directive("acpControlPanel",["$compile","$window","acpLib","acpOptions",function(e,t,o,c){return{restrict:"A",template:'<button class="close-button">X</button>',link:function(e,i,r){var a,s,u=i[0].childNodes[0],l=i.parent()[0].offsetWidth,p=i.parent()[0].offsetHeight,d=t.document.documentElement.clientWidth,f=t.document.documentElement.clientHeight,b=0,h=0,g=c.startPosition.x,m=c.startPosition.y,v=function(e){var n,t;n=o.mouse.pageY(e)-h,t=o.mouse.pageX(e)-b,0>n&&(n=0),0>t&&(t=0),t+l>d&&(t=d-l),n+p>f&&(n=f-p),i.parent().css({top:n+"px",left:t+"px"})},k=function(e){1===e.which&&(i.css("cursor",""),n(t.document).unbind("mousemove",v),n(t.document).unbind("mouseup",k))};"center"!==g&&(a=parseFloat(g),(isNaN(a)||void 0===a)&&(g="center")),"center"!==m&&(s=parseFloat(m),(isNaN(s)||void 0===s)&&(m="center")),i.parent().css({top:"center"===m?f/2-p/2+"px":m,left:"center"===g?d/2-l/2+"px":g}),i.bind("mousedown",function(e){1===e.which&&e.target!==u&&(e.preventDefault(),i.css("cursor","move"),b=o.mouse.pageX(e)-o.obj.positX(i[0]),h=o.mouse.pageY(e)-o.obj.positY(i[0]),n(t.document).bind("mouseup",k),n(t.document).bind("mousemove",v))}),n(u).bind("click",function(n){e.$emit("closeAcp")})}}}]),e.directive("acpMainPanel",["$compile",function(e){return{restrict:"A",template:'<div class="line-piker" acp-line></div><div class="block-picker" acp-block="blockBGColor"></div><div class="out-color" acp-out></div><div class="text"><span>{{instance.rgb}}</span></br><span>{{instance.hex}}</span></br>none: <input ng-model="instance.none" type="checkbox" ng-change="checkboxChange()"></div>'}}]),e.directive("acpLine",["$compile","$window","acpLib",function(e,t,o){var c=function(e,n,t){var o,c,i,e;e=e.getContext("2d"),o=e.createLinearGradient(t/2,n,t/2,0),c=[[255,0,0],[255,255,0],[0,255,0],[0,255,255],[0,0,255],[255,0,255],[255,0,0]];for(var r=0;6>=r;r++)i="rgb("+c[r][0]+","+c[r][1]+","+c[r][2]+")",o.addColorStop(1*r/6,i);e.fillStyle=o,e.fillRect(0,0,t,n)};return{restrict:"A",template:'<div class="arrows"><div id="left-arrow"></div><div id="right-arrow"></div></div><canvas width="20" height="180" class="cLine"></canvas>',link:function(e,i,r){var a,s=0,u=i[0].childNodes[0],l={width:20,height:180,node:i[0].childNodes[1]},p=function(n){var t,c;t=o.mouse.pageY(n)-a,t=0>t?0:t,t=t>l.height?l.height:t,u.style.top=t-2+"px",s=Math.round(t/(l.height/360)),s=Math.abs(s-360),s=360==s?0:s,e.instance.hue=s,c=o.hsv_rgb(s,e.instance.picker.S,e.instance.picker.V),e.$apply(function(){e.instance.blockBGColor="rgb("+o.hsv_rgb(s,100,100)+")",e.instance.rgb="rgb("+c+")",e.instance.hex="#"+o.convertRgbToHex(c),e.$emit("acpEvent")})},d=function(n){var t=180-180/(360/n);u.style.top=t-2+"px",e.instance.hue=n,e.instance.blockBGColor="rgb("+o.hsv_rgb(n,100,100)+")"},f=function(e){p(e)},b=function(e){e.preventDefault(),n(t.document).unbind("mousemove",f),n(t.document).unbind("mouseup",b)};l.node.width=l.width,l.node.height=l.height,c(l.node,l.height,l.width),n(u).bind("mousedown",function(c){1===c.which&&(c.preventDefault(),e.instance.none=!1,a=o.obj.positY(l.node),n(t.document).bind("mouseup",b),n(t.document).bind("mousemove",f))}),n(u.node).bind("click",p),n(l.node).bind("click",function(n){e.instance.none=!1,p(n)}),n(l.node).bind("mousedown",function(e){1===e.which&&(e.preventDefault(),a=o.obj.positY(l.node),n(t.document).bind("mouseup",b),n(t.document).bind("mousemove",f))}),e.$watch("instance.hsv",function(e){e&&e.length>0&&("none"===e&&(e=[359,0,0]),d(e[0]))})}}}]),e.directive("acpBlock",["$compile","$window","acpLib","acpOptions",function(e,t,o,c){return{restrict:"A",template:'<img src="'+c.imgPath+'"><div class="circle"></div>',link:function(e,c,i){var r,a,s,u,l,p,d,f,b=c[0],h=b.childNodes[1],g=function(t){var i,b,g,m,v;c.bind("dragstart",function(){return!1}),c.bind("onselectstart",function(){return!1}),g=o.mouse.pageX(t)-r-l/2,g=0>g?0:g,g=g>s?s:g,n(h).css("left",g+"px"),m=Math.ceil(g/f),b=o.mouse.pageY(t)-a-p/2,b=b>u?u:b,b=0>b?0:b,n(h).css("top",b+"px"),v=Math.ceil(Math.abs(b/d-100)),e.instance.picker.S=m,e.instance.picker.V=v,i=o.hsv_rgb(e.instance.hue,m,v),e.$apply(function(){e.instance.rgb="rgb("+i+")",e.instance.hex="#"+o.convertRgbToHex(i),e.$emit("acpEvent")})},m=function(e){var t=u-u/(255/e[2]),o=s/(1/e[1]);n(h).css({top:t+"px",left:o+"px"})},v=function(e){r=o.obj.positX(b),a=o.obj.positY(b),g(e)},k=function(e){e.preventDefault(),n(t.document).unbind("mousemove",v),n(t.document).unbind("mouseup",k)};e.$watch("instance.blockBGColor",function(e){c.css("background-color",e)}),l=h.offsetWidth,p=h.offsetHeight,s=b.offsetWidth-l,u=b.offsetHeight-p,d=u/100,f=s/100,c.bind("click",function(e){g(e)}),c.bind("mousedown",function(o){1===o.which&&(o.preventDefault(),e.instance.none=!1,v(o),n(t.document).bind("mouseup",k),n(t.document).bind("mousemove",v))}),e.$watch("instance.hsv",function(e){e&&e.length>0&&("none"===e&&(e=[359,0,0]),m(e))})}}}]),e.directive("acpOut",["$compile",function(e){return{restrict:"A",scope:!1,link:function(e,n,t){e.$watch("instance.rgb",function(e){n.css("background-color",e)})}}}])}();