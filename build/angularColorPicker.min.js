!function(){"use strict";{var n=angular.module("angularColorPicker",[]),e=angular.element;angular.forEach}n.value("acpOptions",{imgPath:"../img/bgGradient.png",startPosition:{x:"center",y:"center"}}),n.service("acpLib",function(){return{pareseRgb:function(n){var e=[];return"none"!==n?(n=n.split("(")[1],n=n.split(")")[0],n=n.split(","),angular.forEach(n,function(n){e.push(parseInt(n))}),e):n},pareseHex:function(n){var e,t=[],o=2,c=2,i=0;if("none"!==n){if(n=n.replace("#"),e=n.length,6===e||3===e)for(3===e&&(o=1,c=1);e!==i;)t.push(parseInt(n.substr(i,o),16)),i+=c;else t=[255,255,255];return t}return n},cleanString:function(n){return n.replace(/\s+/g,"")},obj:{positX:function(n){var e,t;return e=0,t=n.getBoundingClientRect(),n=document.body,e=document.documentElement,e=t.left+(e.scrollLeft||n&&n.scrollLeft||0)-(e.clientLeft||n.sclientLeft||0),Math.round(e)},positY:function(n){var e,t;return e=0,t=n.getBoundingClientRect(),n=document.body,e=document.documentElement,e=t.top+(e.scrollTop||n&&n.scrollTop||0)-(e.clientTop||n.sclientTop||0),Math.round(e)}},mouse:{pageX:function(n){var e,t,o;return o=n||event,null==o.pageX&&null!=o.clientX?(e=document.body,t=document.documentElement,n=t.scrollLeft||e&&e.scrollLeft||0,n=o.clientX+n-(t.clientLeft||e.clientLeft||0)):o.pageX},pageY:function(n){var e,t,o;return o=n||event,null==o.pageX&&null!=o.clientX?(e=document.body,t=document.documentElement,n=t.scrollTop||e&&e.scrollTop||0,n=o.clientY+n-(t.clientTop||e.clientTop||0)):o.pageY}},hsv_rgb:function(n,e,t){var o,c,i,r,a,s,u,l;switch(e/=100,t/=100,a=Math.floor(n/60),o=n/60-a,c=t*(1-e),i=t*(1-e*o),r=t*(1-(1-o)*e),a){case 0:s=t,u=r,l=c;break;case 1:s=i,u=t,l=c;break;case 2:s=c,u=t,l=r;break;case 3:s=c,u=i,l=t;break;case 4:s=r,u=c,l=t;break;case 5:s=t,u=c,l=i}return[parseInt(255*s),parseInt(255*u),parseInt(255*l)]},rgb_hsv:function(n){var e,t,o,c,i,r,a,s=[];return n&&n.length>0&&(o=Math.max(n[0],n[1],n[2]),c=Math.min(n[0],n[1],n[2]),t=0===o?0:(o-c)/o,0===t?e=359:(i=(o-n[0])/(o-c),r=(o-n[1])/(o-c),a=(o-n[2])/(o-c),n[0]===o&&(e=a-r),n[1]===o&&(e=2+i-a),n[2]===o&&(e=4+r-i),e=60*e,0>e&&(e+=360)),s.push(e),s.push(t),s.push(o)),s}}}),n.factory("acpModel",function(){var n=[],e={checkInstance:function(e){return e&&n[e]},getInstance:function(e){return n[e]},removeInstance:function(t){e.checkInstance(t)&&delete n[t]},newInstance:function(t){return e.removeInstance(t),n[t]={blockBGColor:"red",rgb:"rgb(255,255,255)",hex:"#ffffff",hue:0,none:!1,picker:{V:100,S:100}}}};return e}),n.directive("angularColorPicker",["$compile","$document","acpModel","acpLib",function(n,t,o,c){return{restrict:"A",scope:{},require:"?ngModel",link:function(i,r,a,s){var u,l,p=a.id||"angular-color-picker-"+Date.now(),d=!1,f=e("<div>"),g=/rgb/,h=function(r){var l,h;u=o.newInstance(p),e(t[0].body).append(f[0]),a.ngModel,s.$valid,(l=c.cleanString(s.$viewValue))&&(h=g.test(l)?c.pareseRgb(l):c.pareseHex(l),u.rgb=l,"none"===h?(u.rgb="",u.hex="",u.hsv="none",u.hue=0,u.picker.V=100,u.picker.S=100,u.blockBGColor="red",u.none=!0):(u.hex="#"+(h[0].toString(16)+""+h[1].toString(16)+h[2].toString(16)),u.hsv=c.rgb_hsv(h),u.none=!1),d=!0),n(f)(i)},b=function(){o.removeInstance(p),d=!1,f.remove()},m=function(n){for(var e=n.target;e&&e!==f[0];)e=e.parentNode;e!==f[0]&&b()};f.addClass("color-picker"),f.attr("acp-window",""),f.attr("name",p),l=c.cleanString(a.angularColorPicker),"rgb"!==l&&"hex"!==l&&(l="rgb"),i.$on("acpEvent",function(n){n.stopPropagation(),d&&s.$setViewValue(u[l])}),i.$on("closeAcp",function(n){n.stopPropagation(),b()}),r.bind("click",h),t.bind("mousedown",m)}}}]),n.directive("acpWindow",["acpLib","acpModel",function(n,e){return{restrict:"A",scope:!0,template:'<div class="control-panel" acp-control-panel></div><div class="main-panel" acp-main-panel></div>',link:function(t,o,c){t.instance=e.getInstance(c.name),t.checkboxChange=function(){var e=t.instance;e.picker.V=100,e.picker.S=100,e.hue=0,e.none?(e.rgb="",e.hex="",e.hsv="none",e.blockBGColor="red"):(e.rgb="rgb(0,0,0)",e.hex="#000",e.hsv=n.rgb_hsv(n.pareseRgb(e.rgb)),e.blockBGColor="rgb("+n.hsv_rgb(0,100,100)+")"),t.$emit("acpEvent")}}}}]),n.directive("acpControlPanel",["$compile","$window","acpLib","acpOptions",function(n,t,o,c){return{restrict:"A",template:'<button class="close-button">X</button>',link:function(n,i,r){var a,s,u=i[0].childNodes[0],l=i.parent()[0].offsetWidth,p=i.parent()[0].offsetHeight,d=t.document.documentElement.clientWidth,f=t.document.documentElement.clientHeight,g=0,h=0,b=c.startPosition.x,m=c.startPosition.y,v=function(n){var e,t;e=o.mouse.pageY(n)-h,t=o.mouse.pageX(n)-g,0>e&&(e=0),0>t&&(t=0),t+l>d&&(t=d-l),e+p>f&&(e=f-p),i.parent().css({top:e+"px",left:t+"px"})},k=function(n){1===n.which&&(i.css("cursor",""),e(t.document).unbind("mousemove",v),e(t.document).unbind("mouseup",k))};"center"!==b&&(a=parseFloat(b),(isNaN(a)||void 0===a)&&(b="center")),"center"!==m&&(s=parseFloat(m),(isNaN(s)||void 0===s)&&(m="center")),i.parent().css({top:"center"===m?f/2-p/2+"px":m,left:"center"===b?d/2-l/2+"px":b}),i.bind("mousedown",function(n){1===n.which&&n.target!==u&&(n.preventDefault(),i.css("cursor","move"),g=o.mouse.pageX(n)-o.obj.positX(i[0]),h=o.mouse.pageY(n)-o.obj.positY(i[0]),e(t.document).bind("mouseup",k),e(t.document).bind("mousemove",v))}),e(u).bind("click",function(e){n.$emit("closeAcp")})}}}]),n.directive("acpMainPanel",["$compile",function(n){return{restrict:"A",template:'<div class="line-piker" acp-line></div><div class="block-picker" acp-block="blockBGColor"></div><div class="out-color" acp-out></div><div class="text"><span>{{instance.rgb}}</span></br><span>{{instance.hex}}</span></br>none: <input ng-model="instance.none" type="checkbox" ng-change="checkboxChange()"></div>'}}]),n.directive("acpLine",["$compile","$window","acpLib",function(n,t,o){var c=function(n,e,t){var o,c,i,n;n=n.getContext("2d"),o=n.createLinearGradient(t/2,e,t/2,0),c=[[255,0,0],[255,255,0],[0,255,0],[0,255,255],[0,0,255],[255,0,255],[255,0,0]];for(var r=0;6>=r;r++)i="rgb("+c[r][0]+","+c[r][1]+","+c[r][2]+")",o.addColorStop(1*r/6,i);n.fillStyle=o,n.fillRect(0,0,t,e)};return{restrict:"A",template:'<div class="arrows"><div id="left-arrow"></div><div id="right-arrow"></div></div><canvas width="20" height="180" class="cLine"></canvas>',link:function(n,i,r){var a,s=0,u=i[0].childNodes[0],l={width:20,height:180,node:i[0].childNodes[1]},p=function(e){var t,c;t=o.mouse.pageY(e)-a,t=0>t?0:t,t=t>l.height?l.height:t,u.style.top=t-2+"px",s=Math.round(t/(l.height/360)),s=Math.abs(s-360),s=360==s?0:s,n.instance.hue=s,c=o.hsv_rgb(s,n.instance.picker.S,n.instance.picker.V),n.$apply(function(){n.instance.blockBGColor="rgb("+o.hsv_rgb(s,100,100)+")",n.instance.rgb="rgb("+c+")",n.instance.hex="#"+(c[0].toString(16)+""+c[1].toString(16)+c[2].toString(16)),n.$emit("acpEvent")})},d=function(e){var t=180-180/(360/e);u.style.top=t-2+"px",n.instance.hue=e,n.instance.blockBGColor="rgb("+o.hsv_rgb(e,100,100)+")"},f=function(n){p(n)},g=function(n){n.preventDefault(),e(t.document).unbind("mousemove",f),e(t.document).unbind("mouseup",g)};l.node.width=l.width,l.node.height=l.height,c(l.node,l.height,l.width),e(u).bind("mousedown",function(c){1===c.which&&(c.preventDefault(),n.instance.none=!1,a=o.obj.positY(l.node),e(t.document).bind("mousemove",f))}),e(u.node).bind("click",p),e(l.node).bind("click",function(e){n.instance.none=!1,p(e)}),e(l.node).bind("mousedown",function(n){1===n.which&&(n.preventDefault(),a=o.obj.positY(l.node),e(t.document).bind("mouseup",g),e(t.document).bind("mousemove",f))}),n.$watch("instance.hsv",function(n){n&&n.length>0&&("none"===n&&(n=[359,0,0]),d(n[0]))})}}}]),n.directive("acpBlock",["$compile","$window","acpLib","acpOptions",function(n,t,o,c){return{restrict:"A",template:'<img src="'+c.imgPath+'"><div class="circle"></div>',link:function(n,c,i){var r,a,s,u,l,p,d,f,g=c[0],h=g.childNodes[1],b=function(t){var i,g,b,m,v;c.bind("dragstart",function(){return!1}),c.bind("onselectstart",function(){return!1}),b=o.mouse.pageX(t)-r-l/2,b=0>b?0:b,b=b>s?s:b,e(h).css("left",b+"px"),m=Math.ceil(b/f),g=o.mouse.pageY(t)-a-p/2,g=g>u?u:g,g=0>g?0:g,e(h).css("top",g+"px"),v=Math.ceil(Math.abs(g/d-100)),n.instance.picker.S=m,n.instance.picker.V=v,i=o.hsv_rgb(n.instance.hue,m,v),n.$apply(function(){n.instance.rgb="rgb("+i+")",n.instance.hex="#"+(i[0].toString(16)+""+i[1].toString(16)+i[2].toString(16)),n.$emit("acpEvent")})},m=function(n){var t=u-u/(255/n[2]),o=s/(1/n[1]);e(h).css({top:t+"px",left:o+"px"})},v=function(n){r=o.obj.positX(g),a=o.obj.positY(g),b(n)},k=function(n){n.preventDefault(),e(t.document).unbind("mousemove",v),e(t.document).unbind("mouseup",k)};n.$watch("instance.blockBGColor",function(n){c.css("background-color",n)}),l=h.offsetWidth,p=h.offsetHeight,s=g.offsetWidth-l,u=g.offsetHeight-p,d=u/100,f=s/100,c.bind("click",function(n){b(n)}),c.bind("mousedown",function(o){1===o.which&&(o.preventDefault(),n.instance.none=!1,v(o),e(t.document).bind("mouseup",k),e(t.document).bind("mousemove",v))}),n.$watch("instance.hsv",function(n){n&&n.length>0&&("none"===n&&(n=[359,0,0]),m(n))})}}}]),n.directive("acpOut",["$compile",function(n){return{restrict:"A",scope:!1,link:function(n,e,t){n.$watch("instance.rgb",function(n){e.css("background-color",n)})}}}])}();